{"version":3,"sources":["app.js"],"names":["paginators","document","querySelectorAll","total","magicTowns","limit","window","location","pathname","page","maxPage","fillGrid","clearHTML","grid","querySelector","forEach","magicTown","div","createElement","classList","add","innerHTML","images","split","state","id","description","population","latitude","longitude","wiki","appendChild","updatePaginator","currentPage","style","display","dataset","textContent","firstChild","remove","async","getAllMagicTowns","res","fetch","origin","json","getMagicTowns","getTotalPages","Math","ceil","length","initMap","map","google","maps","Map","getElementById","zoom","center","lat","lng","Marker","position","getUserPosition","navigator","geolocation","getCurrentPosition","getShortestMagicTown","showError","console","log","coords","shortestMagicTown","largestMagicTown","shortestDistance","largestDistance","distance","sqrt","pow","showMagicTown","error","shortest","largest","shortestTown","largestTown","divContainer","newDiv","addEventListener","paginator"],"mappings":"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","file":"app.js","sourcesContent":["const paginators = document.querySelectorAll(\"li a[href='#visit-heading']\");\r\n\r\nlet limit = window.location.pathname == \"/magicTowns\" ? 15: 5;\r\nlet page = 1;\r\nlet maxPage = 1;\r\nlet total;\r\nlet magicTowns;\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\r\n  await getTotalPages();\r\n\r\n  //Initialize the map once you have all the records\r\n  if(document.querySelector(\"#map\")){\r\n    window.initMap = initMap(magicTowns);\r\n    //Get the shortest magic town\r\n    getUserPosition();\r\n  }\r\n\r\n  if(paginators){\r\n    paginators[0].style.display = \"none\";\r\n\r\n    paginators.forEach((paginator) => {\r\n      paginator.addEventListener(\"click\", async () => {\r\n        page = paginator.dataset.page;\r\n        updatePaginator(page);\r\n\r\n        const magicTowns = await getMagicTowns();\r\n        fillGrid(magicTowns);\r\n      });\r\n    });  \r\n  }\r\n});\r\n\r\n//Functions\r\n\r\nfunction fillGrid(magicTowns) {\r\n  clearHTML();\r\n  const grid = document.querySelector(\".items .row\");\r\n\r\n  magicTowns.forEach((magicTown) => {\r\n    const div = document.createElement(\"div\");\r\n\r\n    div.classList.add(\"col-lg-12\");\r\n\r\n    div.innerHTML += `\r\n    <div class=\"col-lg-12\">\r\n      <div class=\"item\">\r\n        <div class=\"row\">\r\n          <div class=\"col-lg-4 col-sm-5\">\r\n            <div class=\"image\" style='height: 100%'>\r\n              <img loading=\"lazy\" src='${magicTown.images[0]}' alt='${\r\n      magicTown.magicTown\r\n    }' style='height: 100%; object-fit: cover;'>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-lg-8 col-sm-7\">\r\n            <div class=\"right-content\">\r\n              <h4>${magicTown.magicTown.split(\",\")[0]}</h4>\r\n              <span>${magicTown.state}, México</span>\r\n              <div class=\"main-button\">\r\n                <a href=\"/magicTowns/${magicTown.id}\">Conocer más</a>\r\n              </div>\r\n              <p>${magicTown.description}</p>\r\n              <ul class=\"info\">\r\n                <li><i class=\"fa fa-user\"></i> ${\r\n                  magicTown.population\r\n                } habitantes</li>\r\n                <li><i class=\"fa fa-globe\"></i> La: ${magicTown.latitude}</li>\r\n                <li><i class=\"fa fa-globe\"></i> Lo: ${magicTown.longitude}</li>\r\n              </ul>\r\n              <div class=\"text-button\">\r\n                <a href=\"${magicTown.wiki}\" target=\"_blank\" rel=\"noreferrer\">¿Sabes cómo llegar?<i class=\"fa fa-arrow-right\"></i></a>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n    grid.appendChild(div);\r\n  });\r\n}\r\n\r\nfunction updatePaginator(currentPage) {\r\n  if (currentPage == 1) {\r\n    paginators[0].style.display = \"none\";\r\n  } else if (currentPage == maxPage - 1) {\r\n    paginators[3].style.display = \"none\";\r\n    paginators[2].style.display = \"inline-block\";\r\n    paginators[4].style.display = \"inline-block\";\r\n  } else if (currentPage == maxPage) {\r\n    paginators[2].style.display = \"none\";\r\n    paginators[3].style.display = \"none\";\r\n    paginators[4].style.display = \"none\";\r\n  } else {\r\n    paginators[0].style.display = \"inline-block\";\r\n    paginators[2].style.display = \"inline-block\";\r\n    paginators[3].style.display = \"inline-block\";\r\n    paginators[4].style.display = \"inline-block\";\r\n  }\r\n\r\n  paginators[0].dataset.page = +currentPage - 1;\r\n  paginators[1].dataset.page = +currentPage;\r\n  paginators[1].textContent = +currentPage;\r\n  paginators[2].dataset.page = +currentPage + 1;\r\n  paginators[2].textContent = +currentPage + 1;\r\n  paginators[3].dataset.page = +currentPage + 2;\r\n  paginators[3].textContent = +currentPage + 2;\r\n  paginators[4].dataset.page = +currentPage + 1;\r\n}\r\n\r\nfunction clearHTML() {\r\n  const grid = document.querySelector(\".items .row\");\r\n  while (grid.firstChild) {\r\n    grid.firstChild.remove();\r\n  }\r\n}\r\n\r\n//Requests\r\nasync function getAllMagicTowns() {\r\n  const res = await fetch(`${window.location.origin}/v1/magicTowns`);\r\n  return await res.json();\r\n}\r\n\r\nasync function getMagicTowns() {\r\n  const res = await fetch(\r\n    `${window.location.origin}/v1/magicTowns?limit=${limit}&page=${page}`\r\n  );\r\n  return await res.json();\r\n}\r\n\r\nasync function getTotalPages() {\r\n  magicTowns = await getAllMagicTowns();\r\n  maxPage = Math.ceil(magicTowns.length / limit);\r\n}\r\n\r\n//Map\r\nfunction initMap(magicTowns) {\r\n  // The map, centered at Uluru\r\n  const map = new google.maps.Map(document.getElementById(\"map\"), {\r\n    zoom: 6,\r\n    center: {\r\n      lat: 23.6345,\r\n      lng: -102.5528,\r\n    },\r\n  });\r\n\r\n  magicTowns.forEach((magicTown) => {\r\n    new google.maps.Marker({\r\n      position: {\r\n        lat: magicTown.latitude,\r\n        lng: magicTown.longitude,\r\n      },\r\n      map: map,\r\n    });\r\n  });\r\n}\r\n\r\n//Check if browser supports geolocation\r\nfunction getUserPosition() {\r\n  if (\"geolocation\" in navigator) {\r\n    navigator.geolocation.getCurrentPosition(getShortestMagicTown, showError);\r\n  } else {\r\n    console.log(\"Errorr\");\r\n  }\r\n}\r\n\r\n//Set's user's position\r\nfunction getShortestMagicTown(position) {\r\n  const coords = {\r\n    lat: position.coords.latitude,\r\n    lng: position.coords.longitude,\r\n  };\r\n\r\n  let shortestDistance = 99999999999;\r\n  let largestDistance = 0;\r\n  let shortestMagicTown;\r\n  let largestMagicTown;\r\n\r\n  magicTowns.forEach((magicTown) => {\r\n    const distance = Math.sqrt(\r\n      Math.pow(coords.lat - magicTown.latitude, 2) +\r\n        Math.pow(coords.lng - magicTown.longitude, 2)\r\n    );\r\n\r\n    if (distance < shortestDistance) {\r\n      shortestDistance = distance;\r\n      shortestMagicTown = magicTown;\r\n    }\r\n    if (distance > largestDistance) {\r\n      largestDistance = distance;\r\n      largestMagicTown = magicTown;\r\n    }\r\n  });\r\n\r\n  showMagicTown(shortestMagicTown, largestMagicTown);\r\n}\r\n\r\n//Show error where there is a problem with geolocation service\r\nfunction showError(error) {\r\n  console.error(error);\r\n}\r\n\r\nfunction showMagicTown(shortest, largest) {\r\n  const shortestTown = shortest.magicTown;\r\n  const largestTown = largest.magicTown;\r\n\r\n  const divContainer = document.querySelector(\".side-bar-map .row .col-lg-12\");\r\n\r\n  const newDiv = document.createElement(\"div\");\r\n  \r\n  newDiv.innerHTML = \r\n  `\r\n  <br>\r\n  <p>El pueblo mágico más cercano a ti es: <span class='d-block fw-bold'> - ${shortestTown}</span></p>\r\n  <br>\r\n  <p>El pueblo mágico más lejano a ti es: <span class='d-block fw-bold'> - ${largestTown}</span></p>\r\n  `;\r\n\r\n  divContainer.appendChild(newDiv);\r\n}\r\n"]}