{"version":3,"sources":["app.js"],"names":["paginators","document","querySelectorAll","total","magicTowns","limit","page","maxPage","fillGrid","clearHTML","grid","querySelector","forEach","magicTown","div","createElement","classList","add","innerHTML","images","split","state","wiki","description","population","latitude","longitude","appendChild","updatePaginator","currentPage","style","display","dataset","textContent","firstChild","remove","async","getAllMagicTowns","res","fetch","window","location","origin","json","getMagicTowns","getTotalPages","Math","ceil","length","initMap","map","google","maps","Map","getElementById","zoom","center","lat","lng","Marker","position","getUserPosition","navigator","geolocation","getCurrentPosition","getShortestMagicTown","showError","console","log","coords","shortestMagicTown","largestMagicTown","shortestDistance","largestDistance","distance","sqrt","pow","showMagicTown","error","shortest","largest","shortestTown","largestTown","divContainer","newDiv","addEventListener","paginator","setTimeout","children"],"mappings":"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","file":"app.js","sourcesContent":["const paginators = document.querySelectorAll(\"li a[href='#visit-heading']\");\r\n\r\nlet limit = 5;\r\nlet page = 1;\r\nlet maxPage = 1;\r\nlet total;\r\nlet magicTowns;\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\r\n  await getTotalPages();\r\n\r\n  //Initialize the map once you have all the records\r\n  window.initMap = initMap(magicTowns);\r\n  //Get the shortest magic town\r\n  getUserPosition();\r\n\r\n  paginators[0].style.display = \"none\";\r\n\r\n  paginators.forEach((paginator) => {\r\n    paginator.addEventListener(\"click\", async () => {\r\n      page = paginator.dataset.page;\r\n      updatePaginator(page);\r\n\r\n      const magicTowns = await getMagicTowns();\r\n      fillGrid(magicTowns);\r\n    });\r\n  });\r\n\r\n  //Remove the map's popup\r\n  setTimeout(() => {\r\n    document.querySelector(\"#map\").children[1].remove();\r\n    document.querySelector(\"#map\").children[1].remove();\r\n  }, 1000);\r\n});\r\n\r\n//Functions\r\n\r\nfunction fillGrid(magicTowns) {\r\n  clearHTML();\r\n  const grid = document.querySelector(\".items .row\");\r\n\r\n  magicTowns.forEach((magicTown) => {\r\n    const div = document.createElement(\"div\");\r\n\r\n    div.classList.add(\"col-lg-12\");\r\n\r\n    div.innerHTML += `\r\n    <div class=\"col-lg-12\">\r\n      <div class=\"item\">\r\n        <div class=\"row\">\r\n          <div class=\"col-lg-4 col-sm-5\">\r\n            <div class=\"image\" style='height: 100%'>\r\n              <img src='${magicTown.images[0]}' alt='${\r\n      magicTown.magicTown\r\n    }' style='height: 100%; object-fit: cover;'>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-lg-8 col-sm-7\">\r\n            <div class=\"right-content\">\r\n              <h4>${magicTown.magicTown.split(\",\")[0]}</h4>\r\n              <span>${magicTown.state}, México</span>\r\n              <div class=\"main-button\">\r\n                <a href=\"${magicTown.wiki}\" target=\"_blank\" rel=\"noreferrer\">Conocer más</a>\r\n              </div>\r\n              <p>${magicTown.description}</p>\r\n              <ul class=\"info\">\r\n                <li><i class=\"fa fa-user\"></i> ${\r\n                  magicTown.population\r\n                } habitantes</li>\r\n                <li><i class=\"fa fa-globe\"></i> La: ${magicTown.latitude}</li>\r\n                <li><i class=\"fa fa-globe\"></i> Lo: ${magicTown.longitude}</li>\r\n              </ul>\r\n              <div class=\"text-button\">\r\n                <a href=\"about.html\">¿Sabes cómo llegar?<i class=\"fa fa-arrow-right\"></i></a>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n    grid.appendChild(div);\r\n  });\r\n}\r\n\r\nfunction updatePaginator(currentPage) {\r\n  if (currentPage == 1) {\r\n    paginators[0].style.display = \"none\";\r\n  } else if (currentPage == maxPage - 1) {\r\n    paginators[3].style.display = \"none\";\r\n    paginators[2].style.display = \"inline-block\";\r\n    paginators[4].style.display = \"inline-block\";\r\n  } else if (currentPage == maxPage) {\r\n    paginators[2].style.display = \"none\";\r\n    paginators[3].style.display = \"none\";\r\n    paginators[4].style.display = \"none\";\r\n  } else {\r\n    paginators[0].style.display = \"inline-block\";\r\n    paginators[2].style.display = \"inline-block\";\r\n    paginators[3].style.display = \"inline-block\";\r\n    paginators[4].style.display = \"inline-block\";\r\n  }\r\n\r\n  paginators[0].dataset.page = +currentPage - 1;\r\n  paginators[1].dataset.page = +currentPage;\r\n  paginators[1].textContent = +currentPage;\r\n  paginators[2].dataset.page = +currentPage + 1;\r\n  paginators[2].textContent = +currentPage + 1;\r\n  paginators[3].dataset.page = +currentPage + 2;\r\n  paginators[3].textContent = +currentPage + 2;\r\n  paginators[4].dataset.page = +currentPage + 1;\r\n}\r\n\r\nfunction clearHTML() {\r\n  const grid = document.querySelector(\".items .row\");\r\n  while (grid.firstChild) {\r\n    grid.firstChild.remove();\r\n  }\r\n}\r\n\r\n//Requests\r\nasync function getAllMagicTowns() {\r\n  const res = await fetch(`${window.location.origin}/v1/magicTowns`);\r\n  return await res.json();\r\n}\r\n\r\nasync function getMagicTowns() {\r\n  const res = await fetch(\r\n    `${window.location.origin}/v1/magicTowns?limit=${limit}&page=${page}`\r\n  );\r\n  return await res.json();\r\n}\r\n\r\nasync function getTotalPages() {\r\n  magicTowns = await getAllMagicTowns();\r\n  maxPage = Math.ceil(magicTowns.length / limit);\r\n}\r\n\r\n//Map\r\nfunction initMap(magicTowns) {\r\n  // The map, centered at Uluru\r\n  const map = new google.maps.Map(document.getElementById(\"map\"), {\r\n    zoom: 6,\r\n    center: {\r\n      lat: 23.6345,\r\n      lng: -102.5528,\r\n    },\r\n  });\r\n\r\n  magicTowns.forEach((magicTown) => {\r\n    new google.maps.Marker({\r\n      position: {\r\n        lat: magicTown.latitude,\r\n        lng: magicTown.longitude,\r\n      },\r\n      map: map,\r\n    });\r\n  });\r\n}\r\n\r\n//Check if browser supports geolocation\r\nfunction getUserPosition() {\r\n  if (\"geolocation\" in navigator) {\r\n    navigator.geolocation.getCurrentPosition(getShortestMagicTown, showError);\r\n  } else {\r\n    console.log(\"Errorr\");\r\n  }\r\n}\r\n\r\n//Set's user's position\r\nfunction getShortestMagicTown(position) {\r\n  const coords = {\r\n    lat: position.coords.latitude,\r\n    lng: position.coords.longitude,\r\n  };\r\n\r\n  let shortestDistance = 99999999999;\r\n  let largestDistance = 0;\r\n  let shortestMagicTown;\r\n  let largestMagicTown;\r\n\r\n  magicTowns.forEach((magicTown) => {\r\n    const distance = Math.sqrt(\r\n      Math.pow(coords.lat - magicTown.latitude, 2) +\r\n        Math.pow(coords.lng - magicTown.longitude, 2)\r\n    );\r\n\r\n    if (distance < shortestDistance) {\r\n      shortestDistance = distance;\r\n      shortestMagicTown = magicTown;\r\n    }\r\n    if (distance > largestDistance) {\r\n      largestDistance = distance;\r\n      largestMagicTown = magicTown;\r\n    }\r\n  });\r\n\r\n  showMagicTown(shortestMagicTown, largestMagicTown);\r\n}\r\n\r\n//Show error where there is a problem with geolocation service\r\nfunction showError(error) {\r\n  console.error(error);\r\n}\r\n\r\nfunction showMagicTown(shortest, largest) {\r\n  const shortestTown = shortest.magicTown;\r\n  const largestTown = largest.magicTown;\r\n\r\n  const divContainer = document.querySelector(\".side-bar-map .row .col-lg-12\");\r\n\r\n  const newDiv = document.createElement(\"div\");\r\n  \r\n  newDiv.innerHTML = \r\n  `\r\n  <br>\r\n  <p>El pueblo mágico más cercano a ti es: <span class='d-block fw-bold'> - ${shortestTown}</span></p>\r\n  <br>\r\n  <p>El pueblo mágico más lejano a ti es: <span class='d-block fw-bold'> - ${largestTown}</span></p>\r\n  `;\r\n\r\n  divContainer.appendChild(newDiv);\r\n}\r\n"]}